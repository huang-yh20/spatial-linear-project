# 关于生成网络连接权重的说明
## 项目文件夹结构

├─code
│  ├─__pycache__
│  ├─2D_eigs
│  ├─dyn
│  ├─read_ipynb
│  ├─try
│  ├─phase
│  ├─eigs
│  ├─artfigs_NC
│  ├─artfigs_PRE
|  └─spatial_ulits.py
├─figs
└─data

我的项目的文件结构如上所示，共有三个大的文件夹：/code, /figs/, /data。一般而言，我会把项目代码放在/code文件夹下，在/code文件夹中有多个子文件夹，分别是画特征根、相图等子项目所需要用到的代码。我把程序生成的缓存.npy, .pkl等文件放在/data文件夹下，把程序生成的图片、gif等放在/figs文件夹下。

在/code文件夹下，有一个spatial_ultis.py的python文件，里面定义了生成网络连接结构所需要用到的函数。

## 网络连接结构参数
### 数据结构
在spatial_ultis.py中，我定义了一个Network_Params这样的一个nametuple，这个nametuple用于定义网络的连接结构。这个nametuple有以下的参数：

Network_Params = namedtuple('Network_Params', ["N_E", "N_I",
    "d_EE", "d_IE", "d_EI", "d_II",
    "N_EE", "N_IE", "N_EI", "N_II",
    "g_bar_EE", "g_bar_IE", "g_bar_EI", "g_bar_II",
    "g_EE", "g_IE", "g_EI", "g_II"])

其中N_E和N_I代表着兴奋性神经元和抑制性神经元的数目；在我们的模型中，神经元之间的连接概率随着空间距离以高斯函数的形式衰减，d_ab则是由b类神经元投射到a类神经元的连接的这个高斯函数的宽度。N_ab代表平均一个b类神经元投射到多少个a类神经元。g_bar_ab代表者b类神经元投射到a类神经元的连接的平均权重，以N_ab进行约化（也即是b类神经元投射到a类神经元的连接的平均权重是g_bar_ab/N_ab）;g_ab代表者b类神经元投射到a类神经元的连接的连接权重的标准差，以以N_ab进行约化（也即是b类神经元投射到a类神经元的连接权重的标准差是g_ab/sqrt(N_ab)）

我们还定义了一个与spike模拟相关的数据结构,如下：
class Spike_Simul_Params(NamedTuple):
    T: Union[int, float]
    t_step: int
    tau_r:float = 0.5
    tau_m:float = 20.0
    Delta:float = 0.55
    V_th:float = 20
    V_r:float = 10
    input_ext:List = [0.0, 0.0]

其中T代表的是模拟的总时长，t_step代表的是模拟的步长，tau_r代表的是神经元的不应期长度，tau_m代表的是神经元膜电位的时间常数，Delta代表的是突触的延时时间，V_th代表的是神经元的发放阈值，V_r代表的是神经元膜电位reset的电压，input_ext代表的是外界输入到兴奋性神经元和抑制性神经元的泊松过程的均值。

### 定义连接结构的方法
为了定义这个数据结构，我们需要首先在程序中导入spatial_ultis.py，如下所示。

import sys
sys.path.append("./code/")
from spatial_ultis import *

然后，我们需要实例化Network_Params，定义网络的连接结构。如下所示

p_net = Network_Params(N_E = N_E, N_I = N_I,
    N_EE = conn_NEE, N_IE = conn_NIE, N_EI = conn_NEI, N_II = conn_NII,
    d_EE = d_EE, d_IE = d_IE, d_EI = d_EI, d_II = d_II,
    g_bar_EE = g_bar_EE, g_bar_EI = g_bar_EI, g_bar_IE = g_bar_IE, g_bar_II = g_bar_II,
    g_EE = g_EE, g_EI = g_EI, g_IE = g_IE, g_II = g_II
    )
    

## 生成网络的连接权重

在定义完网络结构的参数之后，我们需要把这个网络参数传递给一个生成神经元之间的连接权重的函数。我在spatial_ultis.py中定义了如下函数：

generate_net_sparse(p:Network_Params, dim=2, homo_fix_point = False)

其中，第一个参数是p:Network_Params代表着如上所示的网络结构参数的数据结构，dim代表的是一维还是二维的情况，homo_fix_point指的是要不要求同一种类神经元发放率的不动点的发放率是相同的（只有在这种情况理论才好推导）。对于spike模型而言，homo_fix_point 应选择True。

这个函数的返回值是一个稀疏矩阵coo_matrix，其中矩阵的J_{ij}代表着的是由j神经元投射到i神经元的权重大小。下标的0:N_E是兴奋性神经元，N_E:N_E+N_I是抑制性神经元。

**注意：在二维情况下，兴奋和抑制神经元个数应当是平方数。**







